<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>IEEE 9Bus Example · OpPoDyn.jl</title><meta name="title" content="IEEE 9Bus Example · OpPoDyn.jl"/><meta property="og:title" content="IEEE 9Bus Example · OpPoDyn.jl"/><meta property="twitter:title" content="IEEE 9Bus Example · OpPoDyn.jl"/><meta name="description" content="Documentation for OpPoDyn.jl."/><meta property="og:description" content="Documentation for OpPoDyn.jl."/><meta property="twitter:description" content="Documentation for OpPoDyn.jl."/><meta property="og:url" content="https://juliaenergy.github.io/OpPoDyn.jl/generated/ieee9bus/"/><meta property="twitter:url" content="https://juliaenergy.github.io/OpPoDyn.jl/generated/ieee9bus/"/><link rel="canonical" href="https://juliaenergy.github.io/OpPoDyn.jl/generated/ieee9bus/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OpPoDyn.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../ModelingConcepts/">Modeling Concepts</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>IEEE 9Bus Example</a><ul class="internal"><li><a class="tocitem" href="#Generator-Busses"><span>Generator Busses</span></a></li><li><a class="tocitem" href="#Load-Busses"><span>Load Busses</span></a></li><li><a class="tocitem" href="#Generate-Dynamical-models"><span>Generate Dynamical models</span></a></li><li><a class="tocitem" href="#Branches"><span>Branches</span></a></li><li><a class="tocitem" href="#Initialization"><span>Initialization</span></a></li><li><a class="tocitem" href="#Build-Network"><span>Build Network</span></a></li><li><a class="tocitem" href="#Plotting-the-Solution"><span>Plotting the Solution</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>IEEE 9Bus Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>IEEE 9Bus Example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaEnergy/OpPoDyn.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaEnergy/OpPoDyn.jl/blob/main/docs/examples/ieee9bus.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="IEEE-9Bus-Example"><a class="docs-heading-anchor" href="#IEEE-9Bus-Example">IEEE 9Bus Example</a><a id="IEEE-9Bus-Example-1"></a><a class="docs-heading-anchor-permalink" href="#IEEE-9Bus-Example" title="Permalink"></a></h1><p>In this example, we&#39;re going to model the IEEE 9 bus system.</p><p>The parameters are mainly adopted from the RTDS data.</p><pre><code class="language-julia hljs">using OpPoDyn
using OpPoDyn.Library
using ModelingToolkit
using NetworkDynamics
using Graphs
using OrdinaryDiffEqRosenbrock
using OrdinaryDiffEqNonlinearSolve
using CairoMakie</code></pre><p>The AVRTypeI model contains a ceiling function which needs to parameters. Often, the parameters are not given explicitly but istead their are two datapoints provided. This is the case in the RTDS data, thus we need to solve the nonlinear system to find parameters <code>Ae</code> and <code>Be</code>. Turns out, <code>Ae</code> and <code>Be</code> are quite common default values.</p><pre><code class="language-julia hljs">Ae, Be = Library.solve_ceilf(3.3 =&gt; 0.6602, 4.5 =&gt; 4.2662)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Ae = 0.0039009453730736304, Be = 1.5549466340321914)</code></pre><h2 id="Generator-Busses"><a class="docs-heading-anchor" href="#Generator-Busses">Generator Busses</a><a id="Generator-Busses-1"></a><a class="docs-heading-anchor-permalink" href="#Generator-Busses" title="Permalink"></a></h2><p>The 3 generator buses are modeld using a SauerPai 6th order machine model with variable field voltage and mechanical torque input. The field voltage is provided by an <code>AVRTypeI</code>, the torque is provide by a <code>TGOV1</code> model.</p><pre><code class="language-julia hljs">@mtkmodel GenBus begin
    @components begin
        machine = SauerPaiMachine(;
            vf_input=true,
            τ_m_input=true,
            S_b=100,
            V_b=1,
            ω_b=2π*60,
            R_s=0.000125,
            T″_d0=0.01,
            T″_q0=0.01,
            X_d, X′_d, X″_d, X_q, X′_q, X″_q, X_ls, T′_d0, T′_q0, H # free per machine parameter
        )
        avr = AVRTypeI(vr_min=-5, vr_max=5, Ka=20, Ta=0.2, Kf=0.063,
            Tf=0.35, Ke=1, Te=0.314, Ae, Be, tmeas_lag=false)
        gov = TGOV1(R=0.05, T1=0.05, T2=2.1, T3=7.0, DT=0, V_max=5, V_min=-5)
        busbar = BusBar()
    end
    @equations begin
        connect(machine.terminal, busbar.terminal)
        connect(machine.v_mag_out, avr.vh)
        connect(avr.vf, machine.vf_in)
        connect(gov.τ_m, machine.τ_m_in)
        connect(machine.ωout, gov.ω_meas)
    end
end</code></pre><h2 id="Load-Busses"><a class="docs-heading-anchor" href="#Load-Busses">Load Busses</a><a id="Load-Busses-1"></a><a class="docs-heading-anchor-permalink" href="#Load-Busses" title="Permalink"></a></h2><p>The loard buses are modeled as static PQ loads. This means they allways draw exactly <code>Pset</code> and <code>Qset</code>.</p><pre><code class="language-julia hljs">@mtkmodel LoadBus begin
    @components begin
        busbar = BusBar()
        load = PQLoad(Pset, Qset)
    end
    @equations begin
        connect(load.terminal, busbar.terminal)
    end
end</code></pre><h2 id="Generate-Dynamical-models"><a class="docs-heading-anchor" href="#Generate-Dynamical-models">Generate Dynamical models</a><a id="Generate-Dynamical-models-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-Dynamical-models" title="Permalink"></a></h2><p>The parameters of the machines are obtaind from the data table from the RTDS datasheet.</p><pre><code class="language-julia hljs">gen1p = (;machine__X_ls=0.01460, machine__X_d=0.1460, machine__X′_d=0.0608, machine__X″_d=0.06, machine__X_q=0.1000, machine__X′_q=0.0969, machine__X″_q=0.06, machine__T′_d0=8.96, machine__T′_q0=0.310, machine__H=23.64)
gen2p = (;machine__X_ls=0.08958, machine__X_d=0.8958, machine__X′_d=0.1198, machine__X″_d=0.11, machine__X_q=0.8645, machine__X′_q=0.1969, machine__X″_q=0.11, machine__T′_d0=6.00, machine__T′_q0=0.535, machine__H= 6.40)
gen3p = (;machine__X_ls=0.13125, machine__X_d=1.3125, machine__X′_d=0.1813, machine__X″_d=0.18, machine__X_q=1.2578, machine__X′_q=0.2500, machine__X″_q=0.18, machine__T′_d0=5.89, machine__T′_q0=0.600, machine__H= 3.01)</code></pre><p>We instantiate all models as modeling toolkit models.</p><pre><code class="language-julia hljs">@named mtkbus1 = GenBus(; gen1p...)
@named mtkbus2 = GenBus(; gen2p...)
@named mtkbus3 = GenBus(; gen3p...)
@named mtkbus4 = MTKBus()
@named mtkbus5 = LoadBus(;load__Pset=-1.25, load__Qset=-0.5)
@named mtkbus6 = LoadBus(;load__Pset=-0.90, load__Qset=-0.3)
@named mtkbus7 = MTKBus()
@named mtkbus8 = LoadBus(;load__Pset=-1.0, load__Qset=-0.35)
@named mtkbus9 = MTKBus()</code></pre><p>After this, we can build the NetworkDynamic components using the <code>Bus</code>-constructor.</p><p>The <code>Bus</code> constructor is essentially a thin wrapper around the <code>ODEVertex</code> constructor which, per default, adds some metadata. For example the <code>vidx</code> property which later on allows for &quot;graph free&quot; network dynamics instantiation.</p><pre><code class="language-julia hljs">@named bus1 = Bus(mtkbus1; vidx=1)
@named bus2 = Bus(mtkbus2; vidx=2)
@named bus3 = Bus(mtkbus3; vidx=3)
@named bus4 = Bus(mtkbus4; vidx=4)
@named bus5 = Bus(mtkbus5; vidx=5)
@named bus6 = Bus(mtkbus6; vidx=6)
@named bus7 = Bus(mtkbus7; vidx=7)
@named bus8 = Bus(mtkbus8; vidx=8)
@named bus9 = Bus(mtkbus9; vidx=9)</code></pre><h2 id="Branches"><a class="docs-heading-anchor" href="#Branches">Branches</a><a id="Branches-1"></a><a class="docs-heading-anchor-permalink" href="#Branches" title="Permalink"></a></h2><p>Branches and Transformers are build from the same <code>PILine</code> model with optional transformer on both ends. However, the data is provided in a way that the actual transformer values are 1.0. Apparently, the transforming action has been absorbed into the line parameters according to the base voltage on both ends.</p><p>For the lines we again make use of the <code>src</code> and <code>dst</code> metadata of the <code>StaticEdge</code> objects for automatic graph construction.</p><pre><code class="language-julia hljs">function piline(; R, X, B)
    @named pibranch = PiLine(;R, X, B_src=B/2, B_dst=B/2, G_src=0, G_dst=0)
    MTKLine(pibranch)
end
function transformer(; R, X)
    @named transformer = PiLine(;R, X, B_src=0, B_dst=0, G_src=0, G_dst=0)
    MTKLine(transformer)
end

@named l45 = Line(piline(; R=0.0100, X=0.0850, B=0.1760), src=4, dst=5)
@named l46 = Line(piline(; R=0.0170, X=0.0920, B=0.1580), src=4, dst=6)
@named l57 = Line(piline(; R=0.0320, X=0.1610, B=0.3060), src=5, dst=7)
@named l69 = Line(piline(; R=0.0390, X=0.1700, B=0.3580), src=6, dst=9)
@named l78 = Line(piline(; R=0.0085, X=0.0720, B=0.1490), src=7, dst=8)
@named l89 = Line(piline(; R=0.0119, X=0.1008, B=0.2090), src=8, dst=9)
@named t14 = Line(transformer(; R=0, X=0.0576), src=1, dst=4)
@named t27 = Line(transformer(; R=0, X=0.0625), src=2, dst=7)
@named t39 = Line(transformer(; R=0, X=0.0586), src=3, dst=9)</code></pre><h2 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h2><p>To initialize the system, we first set the &quot;default&quot; values for the bus voltages according to the provide power flow solution from the document.</p><pre><code class="language-julia hljs">set_voltage!(bus1; mag=1.040, arg=deg2rad( 0.0))
set_voltage!(bus2; mag=1.025, arg=deg2rad( 9.3))
set_voltage!(bus3; mag=1.025, arg=deg2rad( 4.7))
set_voltage!(bus4; mag=1.026, arg=deg2rad(-2.2))
set_voltage!(bus5; mag=0.996, arg=deg2rad(-4.0))
set_voltage!(bus6; mag=1.013, arg=deg2rad(-3.7))
set_voltage!(bus7; mag=1.026, arg=deg2rad( 3.7))
set_voltage!(bus8; mag=1.016, arg=deg2rad( 0.7))
set_voltage!(bus9; mag=1.032, arg=deg2rad( 2.0))</code></pre><p>The generator buses have lots of internal states and parameters which need to be initialized. To do so, we need to set the current in addition to the voltage on those buses. The current can be set by provide <code>P</code> and <code>Q</code> instead, which will read out the voltages and define the current accordingly.</p><pre><code class="language-julia hljs">set_current!(bus1; P=0.716, Q= 0.270)
set_current!(bus2; P=1.630, Q= 0.067)
set_current!(bus3; P=0.850, Q=-0.109)</code></pre><p>To initialize the internal states, we just need to call <code>initialize_component!</code>, which will create a nonlinear initialization problem automaticially, which solves for &quot;free&quot; states and parameters.</p><p>Concretely, here we&#39;re solving for all internal machien states and the reference values for voltage and power of the AVR and govenor models.</p><pre><code class="language-julia hljs">initialize_component!(bus1)
initialize_component!(bus2)
initialize_component!(bus3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Initialization problem is fully constrained. Created NonlinearLeastSquaresProblem for [:machine₊δ, :machine₊ω, :machine₊E′_q, :machine₊E′_d, :machine₊ψ″_d, :machine₊ψ″_q, :avr₊vf₊u, :avr₊vr1, :avr₊vr2, :gov₊xg1, :gov₊xg2, :avr₊vref, :gov₊p_ref]
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Initialization successful with residual 5.222796427994071e-14
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Initialization problem is fully constrained. Created NonlinearLeastSquaresProblem for [:machine₊δ, :machine₊ω, :machine₊E′_q, :machine₊E′_d, :machine₊ψ″_d, :machine₊ψ″_q, :avr₊vf₊u, :avr₊vr1, :avr₊vr2, :gov₊xg1, :gov₊xg2, :avr₊vref, :gov₊p_ref]
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Initialization successful with residual 3.262766089943112e-14
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Initialization problem is fully constrained. Created NonlinearLeastSquaresProblem for [:machine₊δ, :machine₊ω, :machine₊E′_q, :machine₊E′_d, :machine₊ψ″_d, :machine₊ψ″_q, :avr₊vf₊u, :avr₊vr1, :avr₊vr2, :gov₊xg1, :gov₊xg2, :avr₊vref, :gov₊p_ref]
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Initialization successful with residual 4.797353606947269e-14</code></pre><h2 id="Build-Network"><a class="docs-heading-anchor" href="#Build-Network">Build Network</a><a id="Build-Network-1"></a><a class="docs-heading-anchor-permalink" href="#Build-Network" title="Permalink"></a></h2><p>Finally, we can build the network by providing the vertices and edges.</p><pre><code class="language-julia hljs">vertexfs = [bus1, bus2, bus3, bus4, bus5, bus6, bus7, bus8, bus9];
edgefs = [l45, l46, l57, l69, l78, l89, t14, t27, t39];
nw = Network(vertexfs, edgefs)
u0 = NWState(nw)
prob = ODEProblem(nw, uflat(u0), (0,100), pflat(u0))
sol = solve(prob, Rodas5P())
nothing</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr33"><span class="sgr1">┌ Warning: </span></span>At t=8.632492209547111, dt was forced below floating point epsilon 1.7763568394002505e-15, and step error estimate = 600.6622525010758. Aborting. There is either an error in your model specification or the true solution is unstable (or the true solution can not be represented in the precision of Float64).
<span class="sgr33"><span class="sgr1">└ </span></span><span class="sgr90">@ SciMLBase ~/.julia/packages/SciMLBase/M57fR/src/integrator_interface.jl:609</span></code></pre><h2 id="Plotting-the-Solution"><a class="docs-heading-anchor" href="#Plotting-the-Solution">Plotting the Solution</a><a id="Plotting-the-Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-Solution" title="Permalink"></a></h2><pre><code class="language-julia hljs">fig = Figure(size=(1000,2000));
ax = Axis(fig[1, 1]; title=&quot;Active power&quot;)
for i in [1,2,3,5,6,8]
    lines!(ax, sol; idxs=VIndex(i,:busbar₊P), label=&quot;Bus $i&quot;, color=Cycled(i))
end
axislegend(ax)
ax = Axis(fig[2, 1]; title=&quot;Voltage magnitude&quot;)
for i in 1:9
    lines!(ax, sol; idxs=VIndex(i,:busbar₊u_mag), label=&quot;Bus $i&quot;, color=Cycled(i))
end
axislegend(ax)
ax = Axis(fig[3, 1]; title=&quot;Voltag angel&quot;)
for i in 1:9
    lines!(ax, sol; idxs=VIndex(i,:busbar₊u_arg), label=&quot;Bus $i&quot;, color=Cycled(i))
end
axislegend(ax)
ax = Axis(fig[4, 1]; title=&quot;Frequency&quot;)
for i in 1:3
    lines!(ax, sol; idxs=VIndex(i,:machine₊ω), label=&quot;Bus $i&quot;, color=Cycled(i))
end
axislegend(ax)</code></pre><img src="9a4c1535.png" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../ModelingConcepts/">« Modeling Concepts</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 2 October 2024 19:16">Wednesday 2 October 2024</span>. Using Julia version 1.11.0-rc4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
